
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>regression_testing</title><meta name="generator" content="MATLAB 8.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2012-10-01"><meta name="DC.source" content="regression_testing.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput"><span class="keyword">function</span> regression_testing(handles)


    test_folder = [<span class="string">'..'</span> filesep <span class="string">'TestDatasets'</span> filesep];


    <span class="keyword">if</span> ~exist(test_folder,<span class="string">'dir'</span>) || length(dir(test_folder)) &lt; 4
       test_folder = <span class="string">'\\icfs17.cc.ic.ac.uk\fogim\Group\Software\Global Analysis\TestDatasets\'</span>;
    <span class="keyword">end</span>



    <span class="comment">% Get Tests</span>
    <span class="comment">%----------------------------------------------------</span>
    contents = dir(test_folder);
    contents = contents(3:end);
    tests = {};

    <span class="keyword">for</span> i=1:length(contents)
        <span class="keyword">if</span> isdir([test_folder contents(i).name])
            tests{end+1} = contents(i).name;
        <span class="keyword">end</span>
    <span class="keyword">end</span>


    <span class="comment">% Run Tests</span>
    <span class="comment">%----------------------------------------------------</span>
    overall_tests_passed = 0;
    overall_tests_failed = 0;

    <span class="keyword">if</span> ~strcmp(computer(<span class="string">'arch'</span>), <span class="string">'maci64'</span>)
      m=memory;
      m_start = m.MemUsedMATLAB;
    <span class="keyword">end</span>



    <span class="keyword">for</span> kk=1:1
    <span class="keyword">for</span> i=1:1

        tests_passed = 0;
        tests_failed = 0;

        disp(<span class="string">'============================================'</span>);
        disp([tests{i}]);
        disp(<span class="string">'============================================'</span>);

        folder = [test_folder tests{i} filesep];

        test_def = file2struct([folder <span class="string">'test_def.txt'</span>]);
        test_spec = file_lines([folder <span class="string">'test_spec.txt'</span>]);

        <span class="keyword">if</span> ~isfield(test_def,<span class="string">'channels'</span>)
            test_def.channels = [];
        <span class="keyword">else</span>
            test_def.channels = str2num(test_def.channels);
        <span class="keyword">end</span>

        test_def.polarised = strcmp(test_def.polarised,<span class="string">'true'</span>);
        test_def.file = [folder test_def.file];

        test_def.file = strrep(test_def.file,<span class="string">'\'</span>,filesep);
        test_def.file = strrep(test_def.file,<span class="string">'/'</span>,filesep);

        <span class="keyword">if</span> strcmp(test_def.data_series,<span class="string">'true'</span>)
            handles.data_series_controller.load_data_series(test_def.file,test_def.mode,test_def.polarised,<span class="string">''</span>,<span class="string">'all'</span>,test_def.channels);
        <span class="keyword">else</span>
            handles.data_series_controller.load_single(test_def.file,test_def.polarised,<span class="string">''</span>,test_def.channels);
        <span class="keyword">end</span>

        handles.data_series_controller.data_series.load_data_settings([folder test_def.data_settings_file]);
        handles.fitting_params_controller.load_fitting_params([folder test_def.fit_param_file]);


        handles.fit_controller.fit();

        <span class="keyword">while</span>(~handles.fit_controller.has_fit)
            pause(0.1);
        <span class="keyword">end</span>

        f = handles.fit_controller.fit_result; <span class="comment">%#ok</span>

        <span class="keyword">for</span> j=1:length(test_spec)

            test_passed = eval(test_spec{j});

            <span class="keyword">if</span> test_passed
                test_result_text = <span class="string">'[*] PASS'</span>;
                tests_passed = tests_passed + 1;
                disp([test_result_text <span class="string">' : '</span> test_spec{j}]);
            <span class="keyword">else</span>
                test_result_text = <span class="string">'[X] FAIL'</span>;
                tests_failed = tests_failed + 1;
                fprintf(2,[test_result_text <span class="string">' : '</span> test_spec{j} <span class="string">'\n'</span>]);
            <span class="keyword">end</span>



        <span class="keyword">end</span>


        disp(<span class="string">'--------------------------------------------'</span>);
        disp([<span class="string">'PASSED '</span> num2str(tests_passed) <span class="string">'/'</span> num2str(tests_passed+tests_failed)]);
        disp(<span class="string">''</span>);

        overall_tests_passed = overall_tests_passed + tests_passed;
        overall_tests_failed = overall_tests_failed + tests_failed;


    <span class="keyword">end</span>


      <span class="keyword">if</span> ~strcmp(computer(<span class="string">'arch'</span>), <span class="string">'maci64'</span>)
         m=memory;
         mem_dif(kk) = m.MemUsedMATLAB - m_start;
      <span class="keyword">end</span>

    <span class="keyword">end</span>

    disp(<span class="string">'============================================'</span>);
    disp([<span class="string">'OVERALL: PASSED '</span> num2str(overall_tests_passed) <span class="string">'/'</span> num2str(overall_tests_passed+overall_tests_failed)]);
    disp(<span class="string">'============================================'</span>);

    <span class="comment">%figure;</span>
    <span class="comment">%plot(mem_dif);</span>

    <span class="keyword">function</span> st = file2struct(file)

        fid=fopen(file);
        st = struct();

        fline = fgetl(fid);
        <span class="keyword">while</span> ischar(fline)
             tokens=regexp(fline,<span class="string">'(\S+)\s*=\s*(.*)'</span>,<span class="string">'tokens'</span>);
             <span class="keyword">if</span> length(tokens) == 1
                 tokens = tokens{1};
                 st.(tokens{1}) = tokens{2};
             <span class="keyword">end</span>
             fline = fgetl(fid);
        <span class="keyword">end</span>
        fclose(fid);


    <span class="keyword">end</span>

    <span class="keyword">function</span> lines = file_lines(file)

        fid=fopen(file);
        lines = {};

        fline = fgetl(fid);
        <span class="keyword">while</span> ischar(fline)
             lines{end+1} = fline;
             fline = fgetl(fid);
        <span class="keyword">end</span>
        fclose(fid);

    <span class="keyword">end</span>


<span class="keyword">end</span>
</pre><pre class="codeoutput">============================================
T01_SimMixedDouble
============================================
</pre><pre class="codeoutput">Undefined variable handles.

Error in regression_testing (line 66)
            handles.data_series_controller.load_data_series(test_def.file,test_def.mode,test_def.polarised,'','all',test_def.channels);
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2012b</a><br></p></div><!--
##### SOURCE BEGIN #####
function regression_testing(handles)


    test_folder = ['..' filesep 'TestDatasets' filesep];
   
    
    if ~exist(test_folder,'dir') || length(dir(test_folder)) < 4
       test_folder = '\\icfs17.cc.ic.ac.uk\fogim\Group\Software\Global Analysis\TestDatasets\'; 
    end
    
   
    
    % Get Tests
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    contents = dir(test_folder);
    contents = contents(3:end);
    tests = {};
    
    for i=1:length(contents)
        if isdir([test_folder contents(i).name])
            tests{end+1} = contents(i).name;
        end
    end
    
    
    % Run Tests
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    overall_tests_passed = 0;
    overall_tests_failed = 0;
    
    if ~strcmp(computer('arch'), 'maci64')
      m=memory; 
      m_start = m.MemUsedMATLAB;
    end
    
   
    
    for kk=1:1
    for i=1:1
        
        tests_passed = 0;
        tests_failed = 0;
        
        disp('============================================');
        disp([tests{i}]);
        disp('============================================');
        
        folder = [test_folder tests{i} filesep];
        
        test_def = file2struct([folder 'test_def.txt']);
        test_spec = file_lines([folder 'test_spec.txt']);
        
        if ~isfield(test_def,'channels')
            test_def.channels = [];
        else
            test_def.channels = str2num(test_def.channels);
        end
        
        test_def.polarised = strcmp(test_def.polarised,'true');
        test_def.file = [folder test_def.file];
        
        test_def.file = strrep(test_def.file,'\',filesep);
        test_def.file = strrep(test_def.file,'/',filesep);
        
        if strcmp(test_def.data_series,'true')
            handles.data_series_controller.load_data_series(test_def.file,test_def.mode,test_def.polarised,'','all',test_def.channels);
        else
            handles.data_series_controller.load_single(test_def.file,test_def.polarised,'',test_def.channels);
        end
        
        handles.data_series_controller.data_series.load_data_settings([folder test_def.data_settings_file]);
        handles.fitting_params_controller.load_fitting_params([folder test_def.fit_param_file]);
        
        
        handles.fit_controller.fit();

        while(~handles.fit_controller.has_fit)
            pause(0.1);
        end
        
        f = handles.fit_controller.fit_result; %#ok
        
        for j=1:length(test_spec)
            
            test_passed = eval(test_spec{j});
            
            if test_passed
                test_result_text = '[*] PASS';
                tests_passed = tests_passed + 1;
                disp([test_result_text ' : ' test_spec{j}]);
            else
                test_result_text = '[X] FAIL';
                tests_failed = tests_failed + 1;
                fprintf(2,[test_result_text ' : ' test_spec{j} '\n']);
            end
            
            
            
        end
        
            
        disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
        disp(['PASSED ' num2str(tests_passed) '/' num2str(tests_passed+tests_failed)]);
        disp('');
        
        overall_tests_passed = overall_tests_passed + tests_passed;
        overall_tests_failed = overall_tests_failed + tests_failed;
        
         
    end
    
     
      if ~strcmp(computer('arch'), 'maci64')
         m=memory; 
         mem_dif(kk) = m.MemUsedMATLAB - m_start;
      end
    
    end
    
    disp('============================================');
    disp(['OVERALL: PASSED ' num2str(overall_tests_passed) '/' num2str(overall_tests_passed+overall_tests_failed)]);
    disp('============================================');
    
    %figure;
    %plot(mem_dif);
    
    function st = file2struct(file)
       
        fid=fopen(file);
        st = struct();
        
        fline = fgetl(fid);
        while ischar(fline)
             tokens=regexp(fline,'(\S+)\s*=\s*(.*)','tokens');
             if length(tokens) == 1
                 tokens = tokens{1};
                 st.(tokens{1}) = tokens{2};
             end
             fline = fgetl(fid);
        end
        fclose(fid);
        
        
    end

    function lines = file_lines(file)
       
        fid=fopen(file);
        lines = {};
        
        fline = fgetl(fid);
        while ischar(fline)
             lines{end+1} = fline;
             fline = fgetl(fid);
        end
        fclose(fid);
        
    end
        
    
end
##### SOURCE END #####
--></body></html>